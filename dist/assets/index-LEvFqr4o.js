(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const h of a.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&i(h)}).observe(document,{childList:!0,subtree:!0});function t(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerPolicy&&(a.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?a.credentials="include":s.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(s){if(s.ep)return;s.ep=!0;const a=t(s);fetch(s.href,a)}})();function M(o,e,t){return o+(e-o)*t}class f{constructor(e){this.game=e}enter(){}exit(){}update(e){}render(e){}handleInput(e){}}class C{static drawStars(e,t,i,s=100){for(let a=0;a<s;a++){const h=a*37%t,l=a*73%i;e.fillStyle="#fff",e.fillRect(h,l,1,1)}}}class O{constructor(){this.canvas=document.getElementById("gameCanvas"),this.ctx=this.canvas.getContext("2d"),this.width=this.canvas.width,this.height=this.canvas.height,this.states={},this.currentState=null,this.previousStateName=null,this.gameData={score:0,lives:3,level:1,highScore:0,metal:0,shopVisited:!1,turboMultiplier:1},this.player=null,this.bullets=[],this.enemies=[],this.stars=[],this.particles=[],this.metal=[],this.proximityBombs=[],this.keys={},this.lastTime=0,this.enemySpawnTimer=0,this.starSpawnTimer=0,this.frameCount=0,this.fps=0,this.fpsTimer=0,this.screenShake={intensity:0,duration:0,maxIntensity:100,decayRate:.9},this.init()}init(){this.setupStates(),this.bindEvents(),this.changeState("menu"),this.gameLoop()}setupStates(){this.states={menu:new I(this),gameplay:new $(this),pause:new H(this),gameOver:new W(this),win:new z(this),settings:new N(this),highscore:new D(this),shop:new V(this)}}changeState(e){if(this.currentState){this.currentState.exit();for(let[t,i]of Object.entries(this.states))if(i===this.currentState){this.previousStateName=t;break}}this.currentState=this.states[e],this.currentState&&this.currentState.enter()}goBack(){this.currentState===this.states.settings?this.changeState("menu"):this.currentState===this.states.shop?this.changeState("gameplay"):this.currentState===this.states.pause?this.changeState("gameplay"):this.currentState===this.states.gameOver?this.changeState("menu"):this.currentState===this.states.win&&this.changeState("menu")}bindEvents(){document.addEventListener("keydown",e=>{this.keys[e.code]=!0,e.code==="Escape"&&(this.currentState===this.states.gameplay?this.changeState("pause"):this.currentState===this.states.pause&&this.changeState("gameplay"))}),document.addEventListener("keyup",e=>{this.keys[e.code]=!1})}update(e){this.currentState&&(this.currentState.update(e),this.currentState.handleInput(this.keys)),this.updateScreenShake(e)}triggerScreenShake(e=100,t=400){this.screenShake.intensity=Math.min(e,this.screenShake.maxIntensity),this.screenShake.duration=t}updateScreenShake(e){this.screenShake.duration>0&&(this.screenShake.duration-=e,this.screenShake.intensity*=this.screenShake.decayRate,(this.screenShake.intensity<.5||this.screenShake.duration<=0)&&(this.screenShake.intensity=0,this.screenShake.duration=0))}getScreenShakeOffset(){return this.screenShake.intensity<=0?{x:0,y:0}:{x:(Math.random()-.5)*4*this.screenShake.intensity,y:(Math.random()-.5)*4*this.screenShake.intensity}}render(){const e=this.getScreenShakeOffset();this.ctx.save(),this.ctx.translate(e.x,e.y),this.currentState&&this.currentState.render(this.ctx),this.ctx.restore()}gameLoop(e=0){const t=e-this.lastTime;this.lastTime=e,this.frameCount++,this.fpsTimer+=t,this.fpsTimer>=1e3&&(this.fps=this.frameCount,this.frameCount=0,this.fpsTimer=0),this.update(t),this.render(),requestAnimationFrame(i=>this.gameLoop(i))}drawMilkyWay(e){const t=Date.now()*.001,i=this.height*.5,s=this.height*.3;e.save();const a=t*20%this.width,h=e.createLinearGradient(0,i-s/2,0,i+s/2);h.addColorStop(0,"rgba(0, 0, 0, 0)"),h.addColorStop(.2,"rgba(80, 40, 20, 0.3)"),h.addColorStop(.4,"rgba(120, 60, 30, 0.5)"),h.addColorStop(.6,"rgba(160, 80, 40, 0.6)"),h.addColorStop(.8,"rgba(120, 60, 30, 0.5)"),h.addColorStop(1,"rgba(0, 0, 0, 0)"),e.fillStyle=h,e.fillRect(a,i-s/2,this.width,s),e.fillRect(a-this.width,i-s/2,this.width,s),this.addAnimatedNoise(e,a,i,s,"rgba(160, 80, 40, 0.2)",.4);const l=e.createLinearGradient(0,i-s/2,0,i+s/2);l.addColorStop(0,"rgba(0, 0, 0, 0)"),l.addColorStop(.1,"rgba(40, 60, 100, 0.15)"),l.addColorStop(.3,"rgba(60, 90, 140, 0.3)"),l.addColorStop(.5,"rgba(80, 120, 180, 0.4)"),l.addColorStop(.7,"rgba(60, 90, 140, 0.3)"),l.addColorStop(.9,"rgba(40, 60, 100, 0.15)"),l.addColorStop(1,"rgba(0, 0, 0, 0)"),e.fillStyle=l,e.fillRect(a,i-s/2,this.width,s),e.fillRect(a-this.width,i-s/2,this.width,s),this.addAnimatedNoise(e,a,i,s,"rgba(60, 90, 140, 0.1)",.3),this.addAnimatedDustLanes(e,a,i,s),e.restore()}addAnimatedNoise(e,t,i,s,a,h){for(let l=0;l<this.width*2;l+=8)for(let r=i-s/2;r<i+s/2;r+=8){const n=(l+t)*.05,m=r*.03;this.simpleNoise(n+m+42)*.5+.5<.3&&(e.fillStyle=a,e.fillRect(l+t,r,8,8),e.fillRect(l+t-this.width,r,8,8))}}addAnimatedDustLanes(e,t,i,s){const h=t*.3;e.fillStyle="rgba(0, 0, 0, 0.3)";for(let l=0;l<150;l++){const r=(h+this.simpleNoise(l*50)*this.width*2)%(this.width*2),n=i+(this.simpleNoise(l*100)*.5-.25)*s*.4,m=this.simpleNoise(l*150)*.5+.5;if(n>=i-s/2&&n<=i+s/2){const g=Math.max(2,m*8);e.fillRect(r,n,g,g),r<this.width?e.fillRect(r+this.width,n,g,g):e.fillRect(r-this.width,n,g,g)}}}simpleNoise(e){return Math.sin(e*12.9898)*Math.cos(e*78.233)*43758.5453%1}}class I extends f{constructor(e){super(e),this.selectedOption=0,this.options=["Play Game","Settings","High Score"],this.keyCooldown=0,this.cooldownTime=200,this.enterCooldown=0}enter(){this.selectedOption=0,this.keyCooldown=0,this.enterCooldown=300}update(e){this.keyCooldown>0&&(this.keyCooldown-=e),this.enterCooldown>0&&(this.enterCooldown-=e)}handleInput(e){e.ArrowUp&&this.keyCooldown<=0&&(this.selectedOption=(this.selectedOption-1+this.options.length)%this.options.length,this.keyCooldown=this.cooldownTime),e.ArrowDown&&this.keyCooldown<=0&&(this.selectedOption=(this.selectedOption+1)%this.options.length,this.keyCooldown=this.cooldownTime),(e.Enter||e.Space)&&this.enterCooldown<=0&&this.selectOption()}selectOption(){switch(this.selectedOption){case 0:this.game.changeState("gameplay");break;case 1:this.game.changeState("settings");break;case 2:this.game.changeState("highscore");break}}render(e){e.fillStyle="#000",e.fillRect(0,0,this.game.width,this.game.height),this.game.drawMilkyWay(e),C.drawStars(e,this.game.width,this.game.height),e.fillStyle="#fff",e.font="48px monospace",e.textAlign="center",e.fillText("Project Panther",this.game.width/2,150),e.font="24px monospace",e.fillText("js13k 2025 Entry",this.game.width/2,200),e.font="20px monospace";for(let t=0;t<this.options.length;t++)t===this.selectedOption?(e.fillStyle="#00ffff",e.fillText("> "+this.options[t],this.game.width/2,300+t*40)):(e.fillStyle="#fff",e.fillText(this.options[t],this.game.width/2,300+t*40));e.fillStyle="#888",e.font="16px monospace",e.fillText("Use Arrow Keys to navigate, Enter to select",this.game.width/2,500)}}class $ extends f{constructor(e){super(e),this.gameOver=!1,this.levelComplete=!1,this.levelObjectives={},this.currentLevelData=null,this.devCooldowns={metal:0,turbo:0,levelNav:0}}enter(){this.game.player||this.initGameplay(),!(this.game.previousStateName==="pause"||this.game.previousStateName==="shop")&&(this.gameOver=!1,this.levelComplete=!1,this.game.gameData.lives=3,this.game.gameData.score=0,this.game.gameData.level=1,this.game.bullets=[],this.game.enemies=[],this.game.particles=[],this.game.metal=[],this.game.enemySpawnTimer=0,this.game.starSpawnTimer=0,this.game.player&&(this.game.player.shieldLevel=this.game.player.maxShieldLevel,this.game.player.shieldRechargeTimer=0,this.game.player.turboLevel=0,this.game.player.turboCharge=0,this.game.player.turboActive=!1,this.game.player.cloakLevel=0,this.game.player.cloakTimer=0,this.game.player.isCloaked=!1,this.game.player.isHit=!1,this.game.player.hitTimer=0,this.game.player.blinkTimer=0,this.game.player.isVisible=!0),this.setupLevel(this.game.gameData.level))}setupLevel(e){this.currentLevelData=this.getLevelData(e),this.levelObjectives={...this.currentLevelData.objectives},this.spawnCounts={asteroids:0,mice:0,shops:0,snakes:0,birds:0,ratboss:0},this.enemyPool=null,console.log(`Level ${e}: ${this.currentLevelData.description}`)}getLevelData(e){const t={1:{description:"Survive 50 asteroids",objectives:{asteroids:50},spawnRules:{asteroids:!0,mice:!1,shops:!1},maxEnemies:8},2:{description:"Survive 50 asteroids and 15 mice",objectives:{asteroids:50,mice:15},spawnRules:{asteroids:!0,mice:!0,shops:!1},maxEnemies:10},3:{description:"Collect the floating shop",objectives:{shops:1},spawnRules:{asteroids:!1,mice:!1,shops:!0},maxEnemies:1},4:{description:"Survive 60 asteroids and 20 mice",objectives:{asteroids:60,mice:20},spawnRules:{asteroids:!0,mice:!0,shops:!1},maxEnemies:12},5:{description:"Survive 70 asteroids, 25 mice, and 10 snakes",objectives:{asteroids:70,mice:25,snakes:10},spawnRules:{asteroids:!0,mice:!0,snakes:!0,shops:!1},maxEnemies:15},6:{description:"Collect the floating shop",objectives:{shops:1},spawnRules:{asteroids:!1,mice:!1,shops:!0},maxEnemies:1},7:{description:"Survive 80 asteroids, 30 mice, and 10 snakes",objectives:{asteroids:80,mice:30,snakes:10},spawnRules:{asteroids:!0,mice:!0,snakes:!0,shops:!1},maxEnemies:18},8:{description:"Survive 90 asteroids, 35 mice, 15 snakes, and 5 birds",objectives:{asteroids:90,mice:35,snakes:15,birds:5},spawnRules:{asteroids:!0,mice:!0,snakes:!0,birds:!0,shops:!1},maxEnemies:20},9:{description:"Collect the floating shop",objectives:{shops:1},spawnRules:{asteroids:!1,mice:!1,shops:!0},maxEnemies:1},10:{description:"First Boss Battle",objectives:{ratboss:1},spawnRules:{asteroids:!1,mice:!1,shops:!1,ratboss:!0},maxEnemies:10}};return t[e]||t[1]}initGameplay(){for(let e=0;e<50;e++){const t=new q(Math.random()*this.game.width,Math.random()*this.game.height,Math.random()*3+1);t.game=this.game,this.game.stars.push(t)}this.game.player=new j(100,this.game.height/2,this.game)}update(e){this.gameOver||this.levelComplete||(Object.keys(this.devCooldowns).forEach(t=>{this.devCooldowns[t]>0&&(this.devCooldowns[t]-=e)}),this.game.player.update(e,this.game.keys,this.game.height),this.game.bullets=this.game.bullets.filter(t=>(t.update(e),!(t.x>this.game.width+10||t instanceof k&&t.age>=t.lifetime))),this.game.enemies.forEach(t=>{t.update(e)}),this.game.enemies=this.game.enemies.filter(t=>t instanceof y&&t.phase==="defeated"&&t.defeatTimer<=0?!1:t.x>-50),this.game.proximityBombs=this.game.proximityBombs.filter(t=>(t.update(e),!t.exploded)),this.game.stars.forEach(t=>t.update(e)),this.game.particles=this.game.particles.filter(t=>(t.update(e),t.life>0)),this.game.metal=this.game.metal.filter(t=>(t.update(e),!t.collected&&t.x>-100)),this.spawnEnemies(e),this.checkCollisions(),this.checkLevelCompletion())}spawnEnemies(e){this.currentLevelData&&(this.enemyPool||this.createEnemyPool(),this.enemyPool.length>0&&this.game.enemies.length<this.currentLevelData.maxEnemies&&(this.game.enemySpawnTimer+=e,this.game.enemySpawnTimer>800&&(this.spawnRandomEnemy(),this.game.enemySpawnTimer=0)))}createEnemyPool(){this.enemyPool=[];const e=this.currentLevelData.spawnRules,t=this.levelObjectives;if(e.asteroids&&t.asteroids)for(let i=0;i<t.asteroids;i++)this.enemyPool.push({type:"asteroid",priority:Math.random()});if(e.mice&&t.mice)for(let i=0;i<t.mice;i++)this.enemyPool.push({type:"mouse",priority:Math.random()});if(e.shops&&t.shops)for(let i=0;i<t.shops;i++)this.enemyPool.push({type:"shop",priority:Math.random()});if(e.snakes&&t.snakes)for(let i=0;i<t.snakes;i++)this.enemyPool.push({type:"snake",priority:Math.random()});if(e.birds&&t.birds)for(let i=0;i<t.birds;i++)this.enemyPool.push({type:"bird",priority:Math.random()});if(e.ratboss&&t.ratboss)for(let i=0;i<t.ratboss;i++)this.enemyPool.push({type:"ratboss",priority:Math.random()});this.enemyPool.sort((i,s)=>i.priority-s.priority),console.log(`Created enemy pool: ${this.enemyPool.length} enemies for level ${this.game.gameData.level}`)}spawnRandomEnemy(){if(this.enemyPool.length===0)return;const e=this.enemyPool.shift();this.spawnEnemy(e.type),this.game.enemySpawnTimer+=(Math.random()-.5)*200}spawnEnemy(e){const t=Math.random()*(this.game.height-40);let i;switch(e){case"asteroid":i=new c(this.game.width+50,t,this.game.gameData.level,0),this.spawnCounts.asteroids++;break;case"mouse":i=new c(this.game.width+50,t,this.game.gameData.level,1),this.spawnCounts.mice++;break;case"shop":i=new c(this.game.width+50,t,this.game.gameData.level,2),this.spawnCounts.shops++;break;case"snake":i=new c(this.game.width+50,t,this.game.gameData.level,3),this.spawnCounts.snakes++;break;case"bird":i=new c(this.game.width+50,t,this.game.gameData.level,4),this.spawnCounts.birds++;break;case"ratboss":i=new y(this.game.width+50,t,this.game),this.spawnCounts.ratboss++;break}if(i){if(i.game=this.game,e==="shop"){const s=this.game.height/4,a=s*1.5;i.width=a,i.height=s,i.speed=60,i.y=(this.game.height-i.height)/2}this.game.enemies.push(i)}}checkLevelCompletion(){if(!this.currentLevelData)return;let e=!0;for(const[s,a]of Object.entries(this.levelObjectives))if(this.spawnCounts[s]<a){e=!1;break}const t=this.game.enemies.some(s=>s.x>-50),i=this.game.metal.some(s=>s.x>-20);e&&!t&&!i&&(this.levelComplete=!0,this.completeLevel())}completeLevel(){console.log(`Level ${this.game.gameData.level} Complete!`),this.game.gameData.score+=1e3,this.game.gameData.level>=10?setTimeout(()=>{this.game.changeState("win")},2e3):setTimeout(()=>{this.game.gameData.level++,this.setupLevel(this.game.gameData.level),this.levelComplete=!1,this.game.enemies=[],this.game.particles=[],this.game.metal=[],this.spawnCounts={asteroids:0,mice:0,shops:0,snakes:0,birds:0,ratboss:0},this.game.gameData.shopVisited=!1},2e3)}checkCollisions(){this.game.bullets.forEach((e,t)=>{this.game.enemies.forEach((i,s)=>{if(this.checkCollision(e,i)){if(i.enemyType===2)return;if(i instanceof y){i.takeDamage(1),this.game.bullets.splice(t,1),this.game.gameData.score+=50;return}if(e instanceof k){this.game.bullets.splice(t,1),this.game.enemies.splice(s,1),this.game.gameData.score+=100,this.createRocketExplosion(i.x+i.width/2,i.y+i.height/2),this.createMetalDrop(i.x+i.width/2,i.y+i.height/2,i.enemyType),console.log("Rocket destroyed enemy!");return}this.game.bullets.splice(t,1),this.game.enemies.splice(s,1),this.game.gameData.score+=100,this.createExplosion(i.x+i.width/2,i.y+i.height/2),this.createMetalDrop(i.x+i.width/2,i.y+i.height/2,i.enemyType)}})}),this.game.enemies.forEach((e,t)=>{if(this.checkCollision(this.game.player,e)){if(e.enemyType===2)if(this.game.gameData.shopVisited){this.game.enemies.splice(t,1);return}else{this.game.enemies.splice(t,1),this.game.gameData.shopVisited=!0,this.game.changeState("shop");return}if(e instanceof y){this.game.player.shieldLevel>0?(this.game.player.shieldLevel=0,this.game.player.shieldRechargeTimer=0):this.game.gameData.lives=Math.max(0,this.game.gameData.lives-2),this.game.player.hit(),this.game.player.decloak(),this.game.triggerScreenShake(15,500),this.game.gameData.lives<=0&&(this.gameOver=!0,this.game.changeState("gameOver"));return}this.game.enemies.splice(t,1),this.createExplosion(e.x+e.width/2,e.y+e.height/2),this.game.player.shieldLevel>0?(this.game.player.shieldLevel--,this.game.player.shieldRechargeTimer=0):this.game.gameData.lives--,this.game.player.hit(),this.game.player.decloak(),this.game.triggerScreenShake(8,300),this.game.gameData.lives<=0&&(this.gameOver=!0,this.game.changeState("gameOver"))}}),this.game.proximityBombs.forEach((e,t)=>{this.checkCollision(this.game.player,e)&&!e.exploded&&e.explode()}),this.game.enemies.forEach(e=>{e.enemyType===4&&this.game.player.isHitByBeam(e)&&(this.game.player.shieldLevel>0?(this.game.player.shieldLevel--,this.game.player.shieldRechargeTimer=0,console.log("Bird beam hit player! Shield damaged. Shields remaining:",this.game.player.shieldLevel)):(this.game.gameData.lives--,console.log("Bird beam hit player! Life lost. Lives remaining:",this.game.gameData.lives)),this.game.player.hit(),this.game.player.decloak(),this.game.player.beamHitCooldown=this.game.player.beamHitCooldownTime,this.createBeamDamageEffect(),this.game.triggerScreenShake&&this.game.triggerScreenShake(12,300),this.game.gameData.lives<=0&&(this.game.gameOver=!0,this.game.changeState("gameOver")))}),this.game.enemies.forEach(e=>{e instanceof y&&e.currentAttack==="tail"&&e.tailAttackTimer<500&&this.checkTailAttackCollision(this.game.player,e)&&(this.game.player.shieldLevel>0?(this.game.player.shieldLevel--,this.game.player.shieldRechargeTimer=0):this.game.gameData.lives--,this.game.player.hit(),this.game.player.decloak(),this.game.triggerScreenShake(10,400),this.game.gameData.lives<=0&&(this.gameOver=!0,this.game.changeState("gameOver")))})}checkTailAttackCollision(e,t){const i=t.x+t.width,s=t.y+t.height*.5,a=i+150,h=s+100;return e.x<a&&e.x+e.width>i&&e.y<h&&e.y+e.height>s-50}checkCollision(e,t){return e.x<t.x+t.width&&e.x+e.width>t.x&&e.y<t.y+t.height&&e.y+e.height>t.y}createExplosion(e,t){for(let i=0;i<12;i++)this.game.particles.push(new Z(e,t,Math.random()*360))}createMetalDrop(e,t,i=0){const s=i===1?1:.7,a=i===1?3:1;if(Math.random()<s)for(let h=0;h<a;h++){const l=i===1?(Math.random()-.5)*30:0,r=i===1?(Math.random()-.5)*20:0,n=new R(e+l,t+r,this.game);this.game.metal.push(n)}}createBeamDamageEffect(){const e=this.game.player;for(let t=0;t<8;t++){const i=Math.random()*.5+2,s=Math.random()*4+2,a=e.x+e.width/2,h=e.y+e.height/2;this.game.particles.push(new F(a,h,i,s))}}createRocketExplosion(e,t){for(let i=0;i<25;i++){const s=Math.random()*360,a=Math.random()*6+4;this.game.particles.push(new _(e,t,s,a))}this.game.triggerScreenShake&&this.game.triggerScreenShake(8,200)}render(e){e.fillStyle="#000",e.fillRect(0,0,this.game.width,this.game.height),this.game.drawMilkyWay(e),this.game.stars.forEach(t=>t.render(e)),this.game.particles.forEach(t=>t.render(e)),this.game.proximityBombs.forEach(t=>t.render(e)),this.game.metal.forEach(t=>t.render(e)),this.game.enemies.forEach(t=>t.render(e)),this.game.bullets.forEach(t=>t.render(e)),this.game.proximityBombs.forEach(t=>t.render(e)),this.game.player&&this.game.player.render(e),this.renderUI(e)}renderUI(e){e.fillStyle="#fff",e.font="20px monospace",e.textAlign="left",e.fillText(`Score: ${this.game.gameData.score}`,20,30),e.fillText(`Lives: ${this.game.gameData.lives}`,20,60),e.fillText(`Level: ${this.game.gameData.level}`,20,90),e.fillText(`Metal: ${this.game.gameData.metal}`,20,120),e.fillText(`FPS: ${this.game.fps}`,20,150),this.renderCloakingBar(e),this.renderShieldBar(e),this.renderTurboBar(e),this.game.player.secondaryWeaponLevel>0&&this.renderRocketCooldownBar(e)}renderRocketCooldownBar(e){const s=this.game.width-120-20,a=20,h=this.game.player.rocketCooldown/this.game.player.rocketCooldownTime;this.renderBar(e,{x:s,y:a,width:120,height:15,label:"ROCKET",value:1-h,maxValue:1,backgroundColor:"#333",foregroundColor:h>0?"#ff6600":"#00ff00",borderColor:"#fff",textColor:"#fff",showSegments:!1,showBorder:!0,showLabel:!0})}renderBar(e,t){const{x:i,y:s,width:a,height:h,label:l,value:r,maxValue:n=1,backgroundColor:m="#333",foregroundColor:g="#00ff00",borderColor:b="#fff",textColor:S="#fff",showSegments:A=!1,segmentCount:v=1,showBorder:P=!0,showLabel:E=!0}=t;if(e.fillStyle=m,e.fillRect(i,s,a,h),r>0)if(e.fillStyle=g,A){const u=a/v,B=Math.floor(r/n*v);for(let d=0;d<B;d++)e.fillRect(i+d*u,s,u,h);if(v>1){e.strokeStyle="#666",e.lineWidth=1;for(let d=1;d<v;d++){const T=i+d*u;e.beginPath(),e.moveTo(T,s),e.lineTo(T,s+h),e.stroke()}}}else{const u=r/n*a;e.fillRect(i,s,u,h)}P&&(e.strokeStyle=b,e.lineWidth=2,e.strokeRect(i,s,a,h)),E&&(e.fillStyle=S,e.font="14px monospace",e.textAlign="center",e.fillText(l,i+a/2,s+15))}renderCloakingBar(e){if(this.game.gameData.level===5)return;const t=this.game.width/3,i=20,s=(this.game.width-t)/2;this.renderBar(e,{x:s,y:20,width:t,height:i,label:"CLOAK",value:this.game.player&&this.game.player.isCloaked?this.game.player.cloakLevel:0,maxValue:1,foregroundColor:"#00ffff",showSegments:!1})}renderShieldBar(e){const t=this.game.width/3,i=20,s=(this.game.width-t)/2;this.renderBar(e,{x:s,y:50,width:t,height:i,label:"SHIELD",value:this.game.player.shieldLevel,maxValue:this.game.player.maxShieldLevel,foregroundColor:"#00ff00",showSegments:!0,segmentCount:this.game.player.maxShieldLevel})}renderTurboBar(e){if(!this.game.player||this.game.player.turboLevel===0)return;const t=this.game.width/3,i=20,s=(this.game.width-t)/2;this.renderBar(e,{x:s,y:80,width:t,height:i,label:"TURBO",value:this.game.player.turboCharge,maxValue:this.game.player.maxTurboCharge,foregroundColor:this.game.player.turboActive?"#ff6600":"#00ff00",showSegments:!1})}handleInput(e){if((e.Digit0||e.Key0)&&this.devCooldowns.metal<=0&&(this.game.gameData.metal+=100,console.log(`Added 100 metal! Total: ${this.game.gameData.metal}`),this.devCooldowns.metal=500),(e.Digit9||e.Key9)&&this.devCooldowns.turbo<=0&&this.game.player&&(this.game.player.turboLevel=1,this.game.player.turboCharge=5,console.log("Turbo Thrust granted via dev controls!"),this.devCooldowns.turbo=1e3),(e.Digit1||e.Key1)&&this.devCooldowns.levelNav<=0)if(this.game.gameData.level>1){const t=this.game.gameData.level-1;this.game.gameData.level=t,this.setupLevel(t),this.resetLevelState(),console.log(`Went to previous level: ${t}`),this.devCooldowns.levelNav=1e3}else console.log("Already at level 1");else if((e.Digit2||e.Key2)&&this.devCooldowns.levelNav<=0)if(this.game.gameData.level<10){const i=this.game.gameData.level+1;this.game.gameData.level=i,this.setupLevel(i),this.resetLevelState(),console.log(`Went to next level: ${i}`),this.devCooldowns.levelNav=1e3}else console.log("Already at max level: 10");e.KeyD&&this.devCooldowns.levelNav<=0&&(this.showLevelDebugInfo(),this.devCooldowns.levelNav=500)}resetLevelState(){this.levelComplete=!1,this.game.enemies=[],this.game.particles=[],this.game.metal=[],this.spawnCounts={asteroids:0,mice:0,shops:0,snakes:0,birds:0,ratboss:0},this.enemyPool=null,this.game.enemySpawnTimer=0,console.log(`Jumped to Level ${this.game.gameData.level}`)}showLevelDebugInfo(){console.log("=== LEVEL DEBUG INFO ==="),console.log(`Current Level: ${this.game.gameData.level}`),console.log(`Level Complete: ${this.levelComplete}`),console.log(`Shop Visited: ${this.game.gameData.shopVisited}`),this.currentLevelData&&(console.log(`Level Description: ${this.currentLevelData.description}`),console.log("Level Objectives:",this.levelObjectives),console.log("Spawn Rules:",this.currentLevelData.spawnRules)),console.log("Spawn Counts:",this.spawnCounts),console.log(`Enemies on screen: ${this.game.enemies.length}`),console.log(`Metal on screen: ${this.game.metal.length}`),console.log(`Landmines on screen: ${this.game.proximityBombs.length}`),console.log(`Enemy Pool: ${this.enemyPool?this.enemyPool.length:"null"}`),console.log("========================")}}class H extends f{constructor(e){super(e)}render(e){this.game.states.gameplay.render(e),e.fillStyle="rgba(0, 0, 0, 0.7)",e.fillRect(0,0,this.game.width,this.game.height),e.fillStyle="#fff",e.font="48px monospace",e.textAlign="center",e.fillText("PAUSED",this.game.width/2,this.game.height/2-50),e.font="20px monospace",e.fillText("Press ESC to resume",this.game.width/2,this.game.height/2),e.fillText("Press M for menu",this.game.width/2,this.game.height/2+40)}handleInput(e){e.KeyM&&this.game.changeState("menu")}}class W extends f{constructor(e){super(e)}enter(){D.saveHighScore(this.game.gameData.score,this.game.gameData.level),this.game.gameData.score>this.game.gameData.highScore&&(this.game.gameData.highScore=this.game.gameData.score)}render(e){this.game.states.gameplay.render(e),e.fillStyle="rgba(0, 0, 0, 0.8)",e.fillRect(0,0,this.game.width,this.game.height),e.fillStyle="#ff0000",e.font="48px monospace",e.textAlign="center",e.fillText("GAME OVER",this.game.width/2,this.game.height/2-80),e.fillStyle="#fff",e.font="24px monospace",e.fillText(`Final Score: ${this.game.gameData.score}`,this.game.width/2,this.game.height/2-20),e.fillText(`High Score: ${this.game.gameData.highScore}`,this.game.width/2,this.game.height/2+20),e.font="20px monospace",e.fillText("Press SPACE to restart",this.game.width/2,this.game.height/2+80),e.fillText("Press M for menu",this.game.width/2,this.game.height/2+120)}handleInput(e){e.Space&&this.game.changeState("gameplay"),e.KeyM&&this.game.goBack()}}class z extends f{constructor(e){super(e)}enter(){D.saveHighScore(this.game.gameData.score,this.game.gameData.level),this.game.gameData.score>this.game.gameData.highScore&&(this.game.gameData.highScore=this.game.gameData.score)}render(e){this.game.states.gameplay.render(e),e.fillStyle="rgba(0, 0, 0, 0.8)",e.fillRect(0,0,this.game.width,this.game.height),e.fillStyle="#00ff00",e.font="48px monospace",e.textAlign="center",e.fillText("VICTORY!",this.game.width/2,this.game.height/2-120),e.fillStyle="#ffff00",e.font="24px monospace",e.fillText("You have defeated the Rat Boss!",this.game.width/2,this.game.height/2-60),e.fillText("Congratulations on completing the game!",this.game.width/2,this.game.height/2-20),e.fillStyle="#fff",e.font="20px monospace",e.fillText(`Final Score: ${this.game.gameData.score}`,this.game.width/2,this.game.height/2+40),e.fillText(`Level Reached: ${this.game.gameData.level}`,this.game.width/2,this.game.height/2+80),e.fillText(`High Score: ${this.game.gameData.highScore}`,this.game.width/2,this.game.height/2+120),e.font="18px monospace",e.fillText("Press SPACE to play again",this.game.width/2,this.game.height/2+180),e.fillText("Press M for main menu",this.game.width/2,this.game.height/2+220)}handleInput(e){e.Space&&(this.game.gameData.level=1,this.game.gameData.lives=3,this.game.gameData.score=0,this.game.gameData.metal=0,this.game.gameData.shopVisited=!1,this.game.changeState("gameplay")),e.KeyM&&this.game.changeState("menu")}}class N extends f{constructor(e){super(e),this.selectedOption=0,this.options=["Test Menu Item","Main Menu"],this.keyCooldown=0,this.cooldownTime=200,this.enterCooldown=0}enter(){this.keyCooldown=0,this.enterCooldown=300}update(e){this.keyCooldown>0&&(this.keyCooldown-=e),this.enterCooldown>0&&(this.enterCooldown-=e)}render(e){e.fillStyle="#000",e.fillRect(0,0,this.game.width,this.game.height),C.drawStars(e,this.game.width,this.game.height),e.fillStyle="#fff",e.font="48px monospace",e.textAlign="center",e.fillText("Settings",this.game.width/2,150),e.font="24px monospace",e.fillText("Game Configuration",this.game.width/2,200),e.font="20px monospace";for(let t=0;t<this.options.length;t++)t===this.selectedOption?(e.fillStyle="#00ffff",e.fillText("> "+this.options[t],this.game.width/2,300+t*40)):(e.fillStyle="#fff",e.fillText(this.options[t],this.game.width/2,300+t*40));e.fillStyle="#888",e.font="16px monospace",e.fillText("Use Arrow Keys to navigate, Enter to select",this.game.width/2,500)}handleInput(e){e.ArrowUp&&this.keyCooldown<=0&&(this.selectedOption=(this.selectedOption-1+this.options.length)%this.options.length,this.keyCooldown=this.cooldownTime),e.ArrowDown&&this.keyCooldown<=0&&(this.selectedOption=(this.selectedOption+1)%this.options.length,this.keyCooldown=this.cooldownTime),(e.Enter||e.Space)&&this.enterCooldown<=0&&this.selectOption()}selectOption(){switch(this.selectedOption){case 0:console.log("Test menu item selected");break;case 1:this.game.goBack();break}}}class D extends f{constructor(e){super(e),this.selectedOption=0,this.options=["Main Menu"],this.keyCooldown=0,this.cooldownTime=200,this.enterCooldown=0}enter(){this.enterCooldown=200}update(e){this.keyCooldown>0&&(this.keyCooldown-=e),this.enterCooldown>0&&(this.enterCooldown-=e)}handleInput(e){(e.Enter||e.Space||e.Escape)&&this.enterCooldown<=0&&this.selectOption()}selectOption(){switch(this.selectedOption){case 0:this.game.changeState("menu");break}}render(e){e.fillStyle="#000",e.fillRect(0,0,this.game.width,this.game.height),this.game.drawMilkyWay(e),this.game.stars.forEach(i=>i.render(e)),e.fillStyle="#fff",e.font="36px monospace",e.textAlign="center",e.fillText("High Scores",this.game.width/2,150);const t=this.getHighScores();e.font="24px monospace",e.fillStyle="#00ffff";for(let i=0;i<Math.min(10,t.length);i++){const s=t[i],a=220+i*35;e.fillText(`${i+1}. ${s.score.toLocaleString()} - Level ${s.level}`,this.game.width/2,a)}t.length===0&&(e.fillStyle="#888",e.font="20px monospace",e.fillText("No high scores yet!",this.game.width/2,300),e.fillText("Play a game to set your first score.",this.game.width/2,330)),e.fillStyle="#00ffff",e.font="20px monospace",e.fillText("> Press ENTER or ESCAPE to return",this.game.width/2,this.game.height-100)}getHighScores(){try{const e=localStorage.getItem("PantherProject.highScores");return e?JSON.parse(e):[]}catch(e){return console.warn("Failed to load high scores:",e),[]}}static saveHighScore(e,t){try{let i=[];const s=localStorage.getItem("PantherProject.highScores");return s&&(i=JSON.parse(s)),i.push({score:e,level:t,date:new Date().toISOString()}),i.sort((a,h)=>h.score-a.score),i=i.slice(0,10),localStorage.setItem("PantherProject.highScores",JSON.stringify(i)),i}catch(i){return console.warn("Failed to save high score:",i),[]}}}class V extends f{constructor(e){super(e),this.selectedOption=0,this.options=["Shield Upgrade (50 Metal)","Agility Boost (30 Metal)","Turbo Thrust (100 Metal)","Double Bullet (80 Metal) - 2 parallel","Triple Bullet (120 Metal) - 2 diagonal","Rocket Launcher (150 Metal)","Return to Game"],this.keyCooldown=0,this.cooldownTime=200,this.enterCooldown=0,this.selectionCooldown=0,this.selectionCooldownTime=500}enter(){this.keyCooldown=0,this.enterCooldown=300}update(e){this.keyCooldown>0&&(this.keyCooldown-=e),this.enterCooldown>0&&(this.enterCooldown-=e),this.selectionCooldown>0&&(this.selectionCooldown-=e)}render(e){e.fillStyle="#000",e.fillRect(0,0,this.game.width,this.game.height),C.drawStars(e,this.game.width,this.game.height),e.fillStyle="#fff",e.font="48px monospace",e.textAlign="center",e.fillText("Shop",this.game.width/2,150),e.font="24px monospace",e.fillText("Purchase Upgrades",this.game.width/2,200),e.fillStyle="#00ff00",e.font="20px monospace",e.fillText(`Metal: ${this.game.gameData.metal}`,this.game.width/2,250),e.font="20px monospace";for(let t=0;t<this.options.length;t++)t===this.selectedOption?(e.fillStyle="#00ffff",e.fillText("> "+this.options[t],this.game.width/2,300+t*40)):(e.fillStyle="#fff",e.fillText(this.options[t],this.game.width/2,300+t*40));e.fillStyle="#888",e.font="16px monospace",e.fillText("Use Arrow Keys to navigate, Enter to select",this.game.width/2,500)}handleInput(e){e.ArrowUp&&this.keyCooldown<=0&&(this.selectedOption=(this.selectedOption-1+this.options.length)%this.options.length,this.keyCooldown=this.cooldownTime),e.ArrowDown&&this.keyCooldown<=0&&(this.selectedOption=(this.selectedOption+1)%this.options.length,this.keyCooldown=this.cooldownTime),(e.Enter||e.Space)&&this.enterCooldown<=0&&this.selectOption()}selectOption(){if(!(this.selectionCooldown>0))switch(this.selectedOption){case 0:this.game.gameData.metal>=50?(this.game.gameData.metal-=50,this.game.player.maxShieldLevel++,this.game.player.shieldLevel=this.game.player.maxShieldLevel,console.log("Shield upgraded!"),this.selectionCooldown=this.selectionCooldownTime):console.log("Not enough metal!");break;case 1:this.game.gameData.metal>=30?(this.game.gameData.metal-=30,this.game.player.speed+=50,console.log("Agility boosted!"),this.selectionCooldown=this.selectionCooldownTime):console.log("Not enough metal!");break;case 2:this.game.gameData.metal>=100?(this.game.gameData.metal-=100,this.game.player.turboLevel=1,this.game.player.turboCharge=5,console.log("Turbo thrust acquired!"),this.selectionCooldown=this.selectionCooldownTime):console.log("Not enough metal!");break;case 3:this.game.gameData.metal>=80?(this.game.gameData.metal-=80,this.game.player.doubleBulletLevel=1,console.log("Double bullet acquired! Level:",this.game.player.doubleBulletLevel),console.log("Now firing 2 parallel bullets instead of 1"),this.selectionCooldown=this.selectionCooldownTime):console.log("Not enough metal!");break;case 4:this.game.gameData.metal>=120?(this.game.gameData.metal-=120,this.game.player.tripleBulletLevel=1,console.log("Triple bullet acquired! Level:",this.game.player.tripleBulletLevel),this.game.player.doubleBulletLevel>0?console.log("Now firing 4 bullets total: 2 parallel + 2 diagonal"):console.log("Now firing 3 bullets total: 1 center + 2 diagonal"),this.selectionCooldown=this.selectionCooldownTime):console.log("Not enough metal!");break;case 5:this.game.gameData.metal>=150?(this.game.gameData.metal-=150,this.game.player.secondaryWeaponLevel=1,console.log("Rocket launcher acquired!"),this.selectionCooldown=this.selectionCooldownTime):console.log("Not enough metal!");break;case 6:this.game.goBack();break}}}class p{constructor(e,t,i,s=2,a=3,h=.02,l="#ffaa00"){this.x=e,this.y=t,this.vx=Math.cos(i*Math.PI/180)*s,this.vy=Math.sin(i*Math.PI/180)*s,this.life=1,this.decay=h,this.size=a,this.color=l}update(e){this.x+=this.vx,this.y+=this.vy,this.life-=this.decay}render(e){e.globalAlpha=this.life,e.fillStyle=this.color,e.fillRect(this.x,this.y,this.size,this.size),e.globalAlpha=1}}class j{constructor(e,t,i){this.x=e,this.y=t,this.width=40,this.height=40,this.speed=300,this.shootCooldown=0,this.shootDelay=200,this.game=i,this.cloakLevel=0,this.cloakTimer=0,this.cloakDelay=5e3,this.cloakDuration=5e3,this.isCloaked=!1,this.shieldLevel=4,this.maxShieldLevel=4,this.shieldRechargeTimer=0,this.shieldRechargeDelay=1e4,this.isHit=!1,this.hitTimer=0,this.hitDuration=4e3,this.blinkInterval=500,this.blinkTimer=0,this.isVisible=!0,this.beamHitCooldown=0,this.beamHitCooldownTime=500,this.turboLevel=0,this.turboCharge=0,this.maxTurboCharge=5,this.turboRechargeRate=.1,this.turboActive=!1,this.secondaryWeaponLevel=0,this.doubleBulletLevel=0,this.tripleBulletLevel=0,this.rocketCooldown=0,this.rocketCooldownTime=1600}update(e,t,i){let s=this.speed;this.turboActive&&this.turboCharge>0&&(s*=2),(t.ArrowLeft||t.KeyA)&&(this.x-=s*e/1e3),(t.ArrowRight||t.KeyD)&&(this.x+=s*e/1e3),(t.ArrowUp||t.KeyW)&&(this.y-=s*e/1e3),(t.ArrowDown||t.KeyS)&&(this.y+=s*e/1e3),this.y<-this.height?this.y=i:this.y>i&&(this.y=-this.height),this.x=Math.max(0,Math.min(this.game.width-this.width,this.x)),this.shootCooldown-=e,t.Space&&this.shootCooldown<=0&&(this.shoot(),this.shootCooldown=this.shootDelay,this.decloak()),t.KeyQ&&this.secondaryWeaponLevel>0&&this.fireSecondaryWeapon(),t.ShiftLeft||t.ShiftRight?this.turboLevel>0&&this.turboCharge>0&&(this.turboActive=!0):this.turboActive=!1,this.updateCloaking(e),this.updateShield(e),this.updateHitEffects(e),this.updateTurbo(e),this.beamHitCooldown>0&&(this.beamHitCooldown-=e),this.rocketCooldown>0&&(this.rocketCooldown-=e)}updateHitEffects(e){this.isHit&&(this.hitTimer+=e,this.blinkTimer+=e,this.blinkTimer>=this.blinkInterval&&(this.isVisible=!this.isVisible,this.blinkTimer=0),this.hitTimer>=this.hitDuration&&(this.isHit=!1,this.isVisible=!0))}updateTurbo(e){this.turboLevel!==0&&(this.turboActive&&this.turboCharge>0?(this.turboCharge-=e/1e3,this.turboCharge<=0&&(this.turboCharge=0,this.turboActive=!1)):!this.turboActive&&this.turboCharge<this.maxTurboCharge&&(this.turboCharge+=this.turboRechargeRate*e/1e3,this.turboCharge>this.maxTurboCharge&&(this.turboCharge=this.maxTurboCharge)),this.turboActive&&this.turboCharge>0?this.game.gameData.turboMultiplier=2:this.game.gameData.turboMultiplier=1)}updateCloaking(e){if(this.game&&this.game.gameData&&this.game.gameData.level===5){this.cloakLevel=0,this.isCloaked=!1;return}if(this.cloakTimer+=e,this.cloakTimer>=this.cloakDelay){const t=(this.cloakTimer-this.cloakDelay)/this.cloakDuration;this.cloakLevel=Math.min(1,t),this.isCloaked=this.cloakLevel>0}}decloak(){this.cloakLevel=0,this.cloakTimer=0,this.isCloaked=!1}isHitByBeam(e){if(e._phase!=="firing"||this.beamHitCooldown>0)return!1;const t=e.y+12,i=3,s=this.y+this.height/2,a=t-i/2,h=t+i/2;return s>=a&&s<=h}updateShield(e){this.shieldLevel<this.maxShieldLevel&&(this.shieldRechargeTimer+=e,this.shieldRechargeTimer>=this.shieldRechargeDelay&&(this.shieldLevel++,this.shieldRechargeTimer=0))}hit(){this.isHit=!0,this.hitTimer=0,this.blinkTimer=0,this.isVisible=!0,this.createHitSparks()}createHitSparks(){for(let e=0;e<12;e++){const t=Math.random()*360,i=Math.random()*3+2,s=this.x+this.width/2,a=this.y+this.height/2;this.game.particles.push(new J(s,a,t,i))}}shoot(){const e=this.y+this.height/2,t=4;if(this.doubleBulletLevel>0?(this.game.bullets.push(new w(this.x+this.width,e-t,this.game)),this.game.bullets.push(new w(this.x+this.width,e+t,this.game))):this.game.bullets.push(new w(this.x+this.width,e,this.game)),this.tripleBulletLevel>0&&(this.game.bullets.push(new L(this.x+this.width,e-t*2,this.game,-45)),this.game.bullets.push(new L(this.x+this.width,e+t*2,this.game,45))),Math.random()<.1){const i=this.game.bullets.length;let s="Single bullet";this.doubleBulletLevel>0&&this.tripleBulletLevel>0?s="Double + Triple (6 bullets)":this.doubleBulletLevel>0?s="Double bullet (2 bullets)":this.tripleBulletLevel>0&&(s="Triple bullet (3 bullets)"),console.log(`${s} - Total bullets: ${i}`)}}fireSecondaryWeapon(){this.secondaryWeaponLevel>0&&this.rocketCooldown<=0&&(this.game.bullets.push(new k(this.x+this.width/2,this.y+this.height/2,this.game)),this.rocketCooldown=this.rocketCooldownTime,console.log("Rocket fired! Cooldown active for",(this.rocketCooldownTime/1e3).toFixed(1),"seconds"))}render(e){if(!(this.isHit&&!this.isVisible)){if(this.isCloaked&&(e.globalAlpha=1-this.cloakLevel),this.turboActive&&this.turboLevel>0&&this.drawTurboFlames(e),e.fillStyle="#000",e.fillRect(this.x,this.y,this.width,this.height),e.fillStyle="#000",e.fillRect(this.x+5,this.y-10,8,10),e.fillRect(this.x+27,this.y-10,8,10),e.fillStyle="#fff",e.fillRect(this.x+8,this.y+5,8,8),e.fillRect(this.x+24,this.y+5,8,8),e.fillStyle="#ff69b4",e.fillRect(this.x+18,this.y+15,4,4),e.strokeStyle="#fff",e.lineWidth=1,e.beginPath(),e.moveTo(this.x-5,this.y+20),e.lineTo(this.x+5,this.y+20),e.moveTo(this.x-5,this.y+25),e.lineTo(this.x+5,this.y+25),e.moveTo(this.x+this.width+5,this.y+20),e.lineTo(this.x+this.width-5,this.y+20),e.moveTo(this.x+this.width+5,this.y+25),e.lineTo(this.x+this.width-5,this.y+25),e.stroke(),this.isCloaked){e.globalAlpha=this.cloakLevel;const t=this.x+this.width/2,i=this.y+this.height/2,s=Math.max(this.width,this.height)*.8,a=Date.now()*.005,h=3;for(let l=0;l<h;l++){const r=s+l*15+Math.sin(a+l*2)*8,n=this.cloakLevel*.6/(l+1);e.globalAlpha=n,e.strokeStyle="#00ffff",e.lineWidth=2,e.setLineDash([5,5]),e.lineDashOffset=a*2,e.beginPath(),e.arc(t,i,r,0,Math.PI*2),e.stroke()}e.setLineDash([])}e.globalAlpha=1}}drawTurboFlames(e){const t=Date.now()*.01,i=this.x-15,s=this.y+this.height/2,a=[{color:"#ff4400",size:25,speed:3,offset:0},{color:"#ff6600",size:20,speed:2,offset:-4},{color:"#ff8800",size:15,speed:1.5,offset:-8},{color:"#ffaa00",size:10,speed:1,offset:-12}];for(let h=0;h<a.length;h++){const l=a[h],r=Math.sin(t*l.speed+h)*.3+.7,n=i-l.offset,m=s+Math.sin(t*2+h)*3;e.save(),e.translate(n,m),e.scale(r,1),e.fillStyle=l.color,e.globalAlpha=.8+r*.2,e.beginPath(),e.ellipse(0,0,l.size,l.size*.4,0,0,Math.PI*2),e.fill(),e.shadowColor=l.color,e.shadowBlur=6,e.fill(),e.shadowBlur=0,e.restore()}}}class c{constructor(e,t,i,s=0){if(this.x=e,this.y=t,this.width=30,this.height=30,this.speed=100+i*20,this.health=1,this.enemyType=s,this.rotation=Math.random()*360,this.rotationSpeed=0,s===0){this.rotationSpeed=Math.random()*60+30,this.asteroidType=Math.floor(Math.random()*4),this.sizeVariation=Math.random()*.4+.8,this.colorVariation=Math.random()*.3+.85,this.detailLevel=Math.floor(Math.random()*3)+2,this.details=[];for(let a=0;a<this.detailLevel;a++)this.details.push({x:Math.random()-.5,y:Math.random()-.5})}this.enemyType===4&&(this._phase="entering")}layBomb(){if(this.game&&this.game.proximityBombs){const e=new G(this.x,this.y,this.game);this.game.proximityBombs.push(e),console.log(`Snake laid landmine at (${this.x}, ${this.y}) - Total landmines: ${this.game.proximityBombs.length}`)}}update(e){const t=this.game.gameData.turboMultiplier||1;if(this.enemyType===0&&(this.x-=this.speed*t*e/1e3,this.rotation+=this.rotationSpeed*e/1e3,this.rotation>360&&(this.rotation-=360),this.rotation<0&&(this.rotation+=360)),this.enemyType===1)if(this.x-=this.speed*.6*t*e/1e3,this.game.player.isCloaked)this.rotation+=15*e/1e3;else{const i=this.game.player.x-this.x,s=this.game.player.y-this.y;this.targetRotation=Math.atan2(s,i)*180/Math.PI;const a=this.targetRotation-this.rotation;this.rotation+=a*e/1e3*2;const h=.3;this.x=M(this.x,this.game.player.x,h*e/1e3),this.y=M(this.y,this.game.player.y,h*e/1e3)}this.enemyType===2&&(this.x-=this.speed*.6*t*e/1e3,this._bobTimer=(this._bobTimer||0)+e/1e3,this.y+=Math.sin(this._bobTimer*2)*.2),this.enemyType===3&&(this.x-=this.speed*.8*t*e/1e3,this.y+=Math.sin(this._diagonalTimer||0)*50*t*e/1e3,this._diagonalTimer=(this._diagonalTimer||0)+e/1e3*2,this._bombTimer=(this._bombTimer||0)+e,this._bombTimer>2e3&&(this.layBomb(),this._bombTimer=0)),this.enemyType===4&&(this._phase==="entering"?(this.x-=this.speed*.5*t*e/1e3,this.x<=this.game.width-100&&(this._phase="firing",this._firingTimer=0,console.log("Bird started firing beam at (",this.x,",",this.y,")"))):this._phase==="firing"?(this._firingTimer+=e,this._firingTimer>3e3&&(this._phase="exiting",console.log("Bird finished firing beam, exiting"))):this._phase==="exiting"&&(this.x-=this.speed*.8*t*e/1e3))}render(e){if(e.save(),this.enemyType===0){e.translate(this.x+this.width/2,this.y+this.height/2),e.rotate(this.rotation*Math.PI/180);const t=this.width*this.sizeVariation,i=this.height*this.sizeVariation;switch(this.asteroidType){case 0:this.drawGenericAsteroid(e,t,i,4);break;case 1:this.drawGenericAsteroid(e,t,i,4);break;case 2:this.drawGenericAsteroid(e,t,i,8);break;case 3:this.drawGenericAsteroid(e,t,i,6);break}}else this.enemyType===1?this.drawMouseEnemy(e):this.enemyType===2?this.drawShop(e):this.enemyType===3?this.drawSnakeEnemy(e):this.enemyType===4&&this.drawBirdEnemy(e);e.restore()}drawMouseEnemy(e){e.save(),e.translate(this.x+this.width/2,this.y+this.height/2),e.rotate(this.rotation*Math.PI/180),e.fillStyle="#808080",e.beginPath(),e.arc(0,0,12,0,Math.PI*2),e.fill(),e.fillStyle="#A0A0A0",e.beginPath(),e.arc(-8,-12,6,0,Math.PI*2),e.fill(),e.beginPath(),e.arc(8,-12,6,0,Math.PI*2),e.fill(),e.fillStyle="#000",e.beginPath(),e.arc(-4,-2,2,0,Math.PI*2),e.fill(),e.beginPath(),e.arc(4,-2,2,0,Math.PI*2),e.fill();const t=Date.now()*.005;this.game.player.isCloaked?e.fillStyle=Math.sin(t*3)>0?"#00ff00":"#003300":e.fillStyle="#ff0000",e.beginPath(),e.arc(0,-8,3,0,Math.PI*2),e.fill(),e.shadowColor=e.fillStyle,e.shadowBlur=8,e.beginPath(),e.arc(0,-8,3,0,Math.PI*2),e.fill(),e.shadowBlur=0,e.restore()}drawShop(e){const t=this.width,i=this.height,s=this.x,a=this.y;e.fillStyle="#2c3e50",e.fillRect(s,a,t,i),e.fillStyle="#34495e",e.fillRect(s+5,a,t-10,i),e.fillRect(s,a+5,t,i-10),e.fillStyle="#1a252f",e.fillRect(s+t*.2,a+i*.1,t*.6,i*.8),e.fillStyle="#3498db";for(let m=0;m<3;m++){const g=s+t*.25+m*t*.2,b=a+i*.2,S=i*.15;e.fillRect(g,b,S,S)}e.fillStyle="#e74c3c";const h=t*.8,l=i*.2,r=s+(t-h)/2,n=a+i*.7;e.fillRect(r,n,h,l),e.fillStyle="#ffffff",e.font=`${i*.15}px monospace`,e.textAlign="center",e.fillText("SHOP",s+t/2,n+l*.7),e.fillStyle="#95a5a6",e.fillRect(s+t*.4,a-i*.1,t*.2,i*.1),e.fillStyle="#7f8c8d",e.fillRect(s-i*.05,a+i*.3,i*.1,i*.4),e.fillRect(s+t,a+i*.3,i*.1,i*.4)}drawGenericAsteroid(e,t,i,s=6){const a=this.adjustColor("#808080",this.colorVariation);e.fillStyle=a,e.beginPath();for(let h=0;h<s;h++){const l=h*Math.PI*2/s,r=Math.cos(l)*t/2,n=Math.sin(l)*i/2;h===0?e.moveTo(r,n):e.lineTo(r,n)}if(e.closePath(),e.fill(),this.details&&this.details.length>0)for(let h=0;h<this.detailLevel&&h<this.details.length;h++){const l=this.details[h],r=t*.25-h*t*.08,n=l.x*t*.3,m=l.y*i*.3;e.fillStyle=this.adjustColor("#404040",this.colorVariation),e.fillRect(-r/2+n,-r/2+m,r,r)}e.fillStyle=this.adjustColor("#c0c0c0",this.colorVariation),this.details&&this.details.length>0&&(e.fillRect(-2+this.details[0].x*t*.1,-i/2+2+this.details[0].y*i*.1,4,4),this.details.length>1&&e.fillRect(t/2-6+this.details[1].x*t*.1,-2+this.details[1].y*i*.1,4,4))}adjustColor(e,t){if(e==="#808080"){const i=Math.floor(128*t);return`rgb(${i}, ${i}, ${i})`}else if(e==="#404040"){const i=Math.floor(64*t);return`rgb(${i}, ${i}, ${i})`}else if(e==="#c0c0c0"){const i=Math.floor(192*t);return`rgb(${i}, ${i}, ${i})`}return e}drawSnakeEnemy(e){e.fillStyle="#00ff00";for(let t=0;t<3;t++){const i=this.x+t*8,s=this.y+Math.sin((this._diagonalTimer||0)*2+t*.5)*3;e.fillRect(i,s,8,12)}e.fillStyle="#008800",e.fillRect(this.x+24,this.y+2,10,8),e.fillStyle="#ff0000",e.fillRect(this.x+26,this.y+4,2,2),e.fillRect(this.x+30,this.y+4,2,2),e.fillStyle="#00aa00",e.fillRect(this.x-4,this.y+4,6,4)}drawBirdEnemy(e){e.fillStyle="#8B4513",e.fillRect(this.x,this.y+8,20,12),e.fillStyle="#654321";const t=Math.sin((this._diagonalTimer||0)*4)*2;e.fillRect(this.x-8,this.y+6+t,12,8),e.fillRect(this.x+16,this.y+6+t,12,8),e.fillStyle="#A0522D",e.fillRect(this.x+18,this.y+6,8,8),e.fillStyle="#FFD700",e.fillRect(this.x+26,this.y+8,4,4),e.fillStyle="#000",e.fillRect(this.x+20,this.y+8,2,2),this._phase==="firing"&&(e.strokeStyle="#ffff00",e.lineWidth=3,e.beginPath(),e.moveTo(this.x+30,this.y+12),e.lineTo(0,this.y+12),e.stroke(),e.shadowColor="#ffff00",e.shadowBlur=10,e.stroke(),e.shadowBlur=0)}}class y extends c{constructor(e,t,i){super(e,t,i.gameData.level,5),this.width=i.width/5,this.height=i.height/5,this.game=i,this.maxHealth=100,this.health=this.maxHealth,this.phase="entering",this.targetX=i.width*.6,this.attackTimer=3e3,this.attackInterval=3e3,this.currentAttack="spawn",this.tailAttackTimer=0,this.tailAttackDuration=2e3,this.spawnAttackTimer=1e3,this.spawnAttackDuration=1e4,this.entranceSpeed=200,this.isVulnerable=!1,this.spawnCount=0,this.maxSpawnsPerWave=10,this.spawnInterval=1e3,this.spawnPauseDuration=5e3,this.isInSpawnPause=!1,this.verticalMovementTimer=0,this.verticalMovementSpeed=100,this.verticalMovementRange=i.height*.2,this.verticalCenter=t}update(e){const t=this.game.gameData.turboMultiplier||1;this.phase==="entering"?(this.x-=this.entranceSpeed*t*e/1e3,this.x<=this.targetX&&(this.x=this.targetX,this.phase="attacking",this.isVulnerable=!0)):this.phase==="attacking"?(this.attackTimer+=e,this.attackTimer>=this.attackInterval&&(this.attackTimer=0,this.currentAttack=this.currentAttack==="tail"?"spawn":"tail",this.currentAttack==="tail"&&(this.y=this.verticalCenter,this.verticalMovementTimer=0)),this.currentAttack==="tail"?this.performTailAttack(e):this.performSpawnAttack(e)):this.phase==="defeated"&&this.defeatTimer>0&&(this.defeatTimer-=e)}performTailAttack(e){if(this.tailAttackTimer+=e,this.tailAttackTimer>=this.tailAttackDuration){this.tailAttackTimer=0;return}this.tailAttackTimer<500&&this.createTailDamageZone()}performSpawnAttack(e){this.spawnAttackTimer+=e,this.verticalMovementTimer+=e;const t=Math.sin(this.verticalMovementTimer*.002)*this.verticalMovementRange;if(this.y=this.verticalCenter+t,this.isInSpawnPause){this.spawnAttackTimer>=this.spawnPauseDuration&&(this.isInSpawnPause=!1,this.spawnAttackTimer=0,this.spawnCount=0);return}if(this.spawnCount>=this.maxSpawnsPerWave){this.isInSpawnPause=!0,this.spawnAttackTimer=0;return}this.spawnAttackTimer>=this.spawnInterval&&(this.spawnEnemiesFromMouth(),this.spawnAttackTimer=0)}createTailDamageZone(){this.tailDamageActive=!0,this.tailDamageTimer=1e3}spawnEnemiesFromMouth(){const t=this.game.width-150,i=100+Math.random()*(this.game.height-200),s=new c(t,i,this.game.gameData.level,1);s.game=this.game,s.spawnedByBoss=!0,this.game.enemies.push(s),this.spawnCount++}takeDamage(e){this.isVulnerable&&(this.health-=e,this.health<=0&&this.defeat(),this.createDamageEffect())}defeat(){this.phase="defeated",this.isVulnerable=!1;for(let e=0;e<50;e++){const t=Math.random()*360,i=Math.random()*8+4;this.game.particles.push(new Y(this.x+this.width/2,this.y+this.height/2,t,i))}for(let e=0;e<20;e++){const t=(Math.random()-.5)*100,i=(Math.random()-.5)*60,s=new R(this.x+this.width/2+t,this.y+this.height/2+i,this.game);this.game.metal.push(s)}this.game.triggerScreenShake&&this.game.triggerScreenShake(200,1e3),this.defeatTimer=2e3}createDamageEffect(){for(let e=0;e<8;e++){const t=Math.random()*360,i=Math.random()*3+2;this.game.particles.push(new X(this.x+this.width/2,this.y+this.height/2,t,i))}}render(e){this.renderHealthBar(e),e.fillStyle="#8B4513",e.fillRect(this.x,this.y,this.width,this.height),this.drawBossDetails(e),this.currentAttack==="tail"&&this.tailAttackTimer<500&&this.drawTailAttack(e),this.isInSpawnPause&&this.drawSpawnPauseIndicator(e)}renderHealthBar(e){const t=this.width,i=10,s=this.x,a=this.y-20;e.fillStyle="#333",e.fillRect(s,a,t,i);const h=this.health/this.maxHealth;e.fillStyle=h>.5?"#00ff00":h>.25?"#ffff00":"#ff0000",e.fillRect(s,a,t*h,i),e.strokeStyle="#fff",e.lineWidth=1,e.strokeRect(s,a,t,i),e.fillStyle="#fff",e.font="12px monospace",e.textAlign="center",e.fillText(`${this.health}/${this.maxHealth}`,s+t/2,a+i/2+4)}drawBossDetails(e){e.fillStyle="#ff0000",e.fillRect(this.x+this.width*.2,this.y+this.height*.2,8,8),e.fillRect(this.x+this.width*.7,this.y+this.height*.2,8,8),e.fillStyle="#000",e.fillRect(this.x+this.width*.4,this.y+this.height*.6,this.width*.2,this.height*.3),e.fillStyle="#654321",e.fillRect(this.x-5,this.y-5,10,15),e.fillRect(this.x+this.width-5,this.y-5,10,15),e.strokeStyle="#654321",e.lineWidth=8,e.beginPath(),e.moveTo(this.x+this.width,this.y+this.height*.5),e.quadraticCurveTo(this.x+this.width+50,this.y+this.height*.3,this.x+this.width+80,this.y+this.height*.7),e.stroke()}drawTailAttack(e){e.strokeStyle="rgba(255, 0, 0, 0.6)",e.lineWidth=20,e.beginPath(),e.moveTo(this.x+this.width,this.y+this.height*.5),e.quadraticCurveTo(this.x+this.width+100,this.y+this.height*.2,this.x+this.width+150,this.y+this.height*.8),e.stroke()}drawSpawnPauseIndicator(e){e.fillStyle="rgba(255, 255, 0, 0.7)",e.font="16px monospace",e.textAlign="center",e.fillText("SPAWN PAUSED",this.x+this.width/2,this.y-30);const t=this.width,i=4,s=this.x,a=this.y-40;e.fillStyle="rgba(255, 255, 0, 0.3)",e.fillRect(s,a,t,i);const h=this.spawnAttackTimer/this.spawnPauseDuration;e.fillStyle="rgba(255, 255, 0, 0.8)",e.fillRect(s,a,t*h,i)}}class Y{constructor(e,t,i,s){this.x=e,this.y=t,this.vx=Math.cos(i*Math.PI/180)*s,this.vy=Math.sin(i*Math.PI/180)*s,this.life=1,this.decay=.02,this.size=Math.random()*6+4,this.color=["#ff6600","#ff0000","#ffff00"][Math.floor(Math.random()*3)]}update(e){this.x+=this.vx,this.y+=this.vy,this.life-=this.decay}render(e){e.globalAlpha=this.life,e.fillStyle=this.color,e.fillRect(this.x,this.y,this.size,this.size),e.globalAlpha=1}}class X extends p{constructor(e,t,i,s=3){const a=Math.random()*3+2;super(e,t,i,s,a,.05,"#ff0000")}render(e){e.globalAlpha=this.life,e.fillStyle=this.color,e.fillRect(this.x,this.y,this.size,this.size),e.fillRect(this.x+2,this.y+2,this.size-4,this.size-4),e.globalAlpha=1}}class F extends p{constructor(e,t,i,s=4){const a=Math.random()*4+3;super(e,t,i,s,a,.08,"#ffff00")}render(e){e.globalAlpha=this.life,e.fillStyle=this.color,e.fillRect(this.x,this.y,this.size,this.size),e.shadowColor=this.color,e.shadowBlur=6,e.fillRect(this.x,this.y,this.size,this.size),e.shadowBlur=0,e.globalAlpha=1}}class _ extends p{constructor(e,t,i,s=5){const a=Math.random()*5+4,h=["#ff6600","#ff0000","#ffff00","#ff8800"][Math.floor(Math.random()*4)];super(e,t,i,s,a,.06,h)}render(e){e.globalAlpha=this.life,e.fillStyle=this.color,e.fillRect(this.x,this.y,this.size,this.size),e.shadowColor=this.color,e.shadowBlur=8,e.fillRect(this.x,this.y,this.size,this.size),e.shadowBlur=0,e.globalAlpha=1}}class G{constructor(e,t,i){this.x=e,this.y=t,this.width=8,this.height=8,this.game=i,this.explosionRadius=60,this.exploded=!1,this.blinkTimer=0,this.blinkInterval=200,this.speed=30,this.lifetime=15e3,this.age=0,this.driftDirection=Math.random()*360,this.driftSpeed=Math.random()*20+10}update(e){if(this.blinkTimer+=e,this.age+=e,this.age>=this.lifetime){this.exploded=!0,console.log(`Landmine auto-despawned after ${(this.lifetime/1e3).toFixed(1)}s at (${this.x.toFixed(1)}, ${this.y.toFixed(1)})`);return}if(!this.exploded){const t=this.driftDirection*Math.PI/180;if(this.x+=Math.cos(t)*this.driftSpeed*e/1e3,this.y+=Math.sin(t)*this.driftSpeed*e/1e3,this.x<-this.width||this.x>this.game.width+this.width||this.y<-this.height||this.y>this.game.height+this.height){this.exploded=!0,console.log(`Landmine drifted off-screen at (${this.x.toFixed(1)}, ${this.y.toFixed(1)})`);return}}if(!this.exploded&&this.game.player){const t=this.x-this.game.player.x,i=this.y-this.game.player.y;Math.sqrt(t*t+i*i)<this.explosionRadius&&this.explode()}}explode(){this.exploded=!0,console.log(`Landmine exploded at (${this.x}, ${this.y})`);for(let e=0;e<20;e++){const t=Math.random()*360,i=Math.random()*5+3;this.game.particles.push(new K(this.x,this.y,t,i))}if(this.game.triggerScreenShake&&this.game.triggerScreenShake(50,300),this.game.player){const e=this.x-this.game.player.x,t=this.y-this.game.player.y;Math.sqrt(e*e+t*t)<this.explosionRadius&&(this.game.player.shieldLevel>0?(this.game.player.shieldLevel--,this.game.player.shieldRechargeTimer=0,console.log("Landmine explosion hit player! Shield damaged. Shields remaining:",this.game.player.shieldLevel)):(this.game.gameData.lives--,console.log("Landmine explosion hit player! Life lost. Lives remaining:",this.game.gameData.lives)),this.game.player.hit(),this.game.player.decloak(),this.game.triggerScreenShake&&this.game.triggerScreenShake(15,400),this.game.gameData.lives<=0&&(this.game.gameOver=!0,this.game.changeState("gameOver")))}}render(e){if(!this.exploded){if(this.age>1e3){e.globalAlpha=.3,e.fillStyle="#ff0000";for(let t=1;t<=3;t++){const i=this.x-Math.cos(this.driftDirection*Math.PI/180)*t*8,s=this.y-Math.sin(this.driftDirection*Math.PI/180)*t*8;e.fillRect(i,s,2,2)}e.globalAlpha=1}Math.floor(this.blinkTimer/this.blinkInterval)%2===0&&(e.fillStyle="#ff0000",e.fillRect(this.x,this.y,this.width,this.height),e.shadowColor="#ff0000",e.shadowBlur=8,e.fillRect(this.x,this.y,this.width,this.height),e.shadowBlur=0)}}}class K extends p{constructor(e,t,i,s=4){const a=Math.random()*4+2;super(e,t,i,s,a,.05,"#ff6600")}}class w{constructor(e,t,i){this.x=e,this.y=t,this.width=8,this.height=3,this.speed=500,this.game=i}update(e){const t=this.game.gameData.turboMultiplier||1;this.x+=this.speed*t*e/1e3}render(e){e.fillStyle="#ffff00",e.fillRect(this.x,this.y,this.width,this.height)}}class L extends w{constructor(e,t,i,s){super(e,t,i),this.angle=s,this.speed=400}update(e){const t=this.game.gameData.turboMultiplier||1,i=this.angle*Math.PI/180;this.x+=Math.cos(i)*this.speed*t*e/1e3,this.y+=Math.sin(i)*this.speed*t*e/1e3}render(e){e.fillStyle="#ff00ff",e.fillRect(this.x,this.y,this.width,this.height)}}class k extends w{constructor(e,t,i){super(e,t,i),this.width=6,this.height=6,this.speed=300,this.deployed=!1,this.deployTimer=0,this.deployDelay=500,this.target=null,this.smokeTimer=0,this.smokeInterval=100,this.lifetime=8e3,this.age=0}update(e){if(this.age+=e,this.age>=this.lifetime){this.deployed=!0,console.log("Rocket auto-despawned after",(this.lifetime/1e3).toFixed(1),"seconds");return}if(!this.deployed)this.deployTimer+=e,this.deployTimer>=this.deployDelay?this.deployed=!0:this.x+=50*e/1e3;else{if(this.target||this.findTarget(),this.target){const t=this.target.x-this.x,i=this.target.y-this.y,s=Math.sqrt(t*t+i*i);s>0&&(this.x+=t/s*this.speed*e/1e3,this.y+=i/s*this.speed*e/1e3)}else this.x+=this.speed*e/1e3;this.smokeTimer+=e,this.smokeTimer>=this.smokeInterval&&(this.createSmoke(),this.smokeTimer=0)}}findTarget(){let e=1/0,t=null;for(const i of this.game.enemies){const s=i.x-this.x,a=i.y-this.y,h=Math.sqrt(s*s+a*a);h<e&&(e=h,t=i)}this.target=t}createSmoke(){for(let e=0;e<3;e++){const t=Math.random()*10-5,i=Math.random()*10-5;this.game.particles.push(new U(this.x-10+t,this.y+i))}}render(e){this.deployed?(e.fillStyle="#ff6600",e.fillRect(this.x,this.y,this.width,this.height),e.fillStyle="#ffff00",e.fillRect(this.x-8,this.y+1,4,4)):(e.fillStyle="#888888",e.fillRect(this.x,this.y,this.width,this.height))}}class U extends p{constructor(e,t){const i=Math.random()*360,s=Math.random()*3+2;super(e,t,i,1,s,.02,"#666666")}}class q{constructor(e,t,i){this.x=e,this.y=t,this.speed=i}update(e){const t=this.game.gameData.turboMultiplier||1;this.x-=this.speed*t*e/1e3,this.x<-10&&(this.x+=this.game.width+20,this.y=Math.random()*this.game.height)}render(e){e.fillStyle="#ffffff",e.fillRect(this.x,this.y,1,1)}}class J extends p{constructor(e,t,i,s=4){const a=Math.random()*3+2;super(e,t,i,s,a,.03,"#ffff00")}}class Z extends p{constructor(e,t,i){const s=Math.random()*4+3;super(e,t,i,3,s,.015,"#ffff00")}}class R{constructor(e,t,i){this.x=e,this.y=t,this.width=8,this.height=8,this.collected=!1,this.collectRadius=40,this.floatOffset=0,this.floatSpeed=2,this.driftSpeed=50,this.game=i}update(e){this.floatOffset+=this.floatSpeed*e/1e3,this.floatOffset>Math.PI*2&&(this.floatOffset-=Math.PI*2);const t=this.game.gameData.turboMultiplier||1;if(this.x-=this.driftSpeed*t*e/1e3,!this.collected&&this.game&&this.game.player){const i=this.x-this.game.player.x,s=this.y-this.game.player.y;Math.sqrt(i*i+s*s)<this.collectRadius&&this.collect()}}collect(){this.collected||(this.collected=!0,this.game.gameData.metal++)}render(e){if(this.collected)return;const t=this.y+Math.sin(this.floatOffset)*3;e.fillStyle="#c0c0c0",e.fillRect(this.x,t,this.width,this.height)}}window.addEventListener("load",()=>{new O});
